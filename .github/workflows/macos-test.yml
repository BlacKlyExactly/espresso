build-and-test-macos:
  name: macOS Build & Test
  runs-on: macos-latest

  steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Compile Espresso server
      run: |
        make
        ls -l main

    - name: Run server in background
      run: |
        ./main & 
        sleep 3

    - name: Test endpoints
      run: |
        curl "http://localhost:8080/"
        curl "http://localhost:8080/api/"
        curl "http://localhost:8080/api/echo?msg=HelloWorld"

    - name: Kill server
      run: pkill -f main || echo "Server already stopped"
